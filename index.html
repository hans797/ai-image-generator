<!DOCTYPE html>
<html>
<head>
  <title>AI图片生成器</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 0 auto; padding: 20px; }
    textarea { width: 100%; height: 100px; margin: 10px 0; }
    button { padding: 10px 20px; background: #0070f3; color: white; border: none; cursor: pointer; }
    #result { margin-top: 20px; }
    #result img { max-width: 100%; }
    .loading { color: #666; }
  </style>
</head>
<body>
  <h1>AI图片生成器</h1>
  <textarea id="prompt" placeholder="例如：一只穿着宇航服的柴犬，卡通风格"></textarea>
  <button onclick="generateImage()">生成图片</button>
  <div id="result"></div>

  <script>
    async function generateImage() {
      const prompt = document.getElementById('prompt').value;
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p class="loading">生成中，请稍候...（通常需要10-30秒）</p>';

      try {
        const response = await fetch('https://api.replicate.com/v1/predictions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'REPLICATE_API_KEY' // 替换为你的API Key
          },
          body: JSON.stringify({
            version: "stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b",
            input: { prompt }
          })
        });

        const data = await response.json();
        if (data.error) throw new Error(data.error);
        
        // 轮询获取结果（Replicate生成是异步的）
        const imageUrl = await pollForResult(data.urls.get);
        resultDiv.innerHTML = `<img src="${imageUrl}" alt="生成的图片">`;
      } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">错误: ${error.message}</p>`;
      }
    }

    async function pollForResult(url) {
      while (true) {
        const response = await fetch(url, {
          headers: { 'Authorization': 'Token REPLICATE_API_KEY' }
        });
        const data = await response.json();
        if (data.status === 'succeeded') return data.output[0];
        if (data.status === 'failed') throw new Error('生成失败');
        await new Promise(resolve => setTimeout(resolve, 1000)); // 每秒检查一次
      }
    }
  </script>
</body>
</html>
